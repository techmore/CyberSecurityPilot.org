<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CIS Security Reports</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow">
            <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
                <h1 class="text-3xl font-bold text-gray-900">
                    CIS Security Reports
                </h1>
            </div>
        </header>

        <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
            <!-- Reports List -->
            <div class="bg-white shadow rounded-lg">
                <div class="px-4 py-4 sm:p-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-4">Available Reports</h2>
                    <div id="reportsList" class="space-y-4">
                        <!-- Reports will be loaded here -->
                        <div class="text-center text-gray-500 py-4">Loading reports...</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Function to format date
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }

        // Function to create a report card
        function createReportCard(report, prevReport) {
            const passedDelta = prevReport ? report.passed - prevReport.passed : 0;
            const failedDelta = prevReport ? report.failed - prevReport.failed : 0;

            return `
                <div class="border rounded-lg overflow-hidden">
                    <div class="bg-white px-4 py-4">
                        <div class="flex flex-col p-1">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="text-base font-medium text-gray-900">Report from ${formatDate(report.date)}</h3>
                                    <div class="mt-0.5 text-sm text-gray-600">
                                        ${report.hostname} • ${report.model} • macOS ${report.macos_version} • ${report.processor} • ${report.memory}
                                    </div>
                                </div>
                                <div class="flex items-center space-x-4">
                                    ${passedDelta !== 0 ? `
                                        <div class="text-lg font-medium">
                                            <span class="${passedDelta > 0 ? 'text-green-600' : 'text-red-600'}">
                                                ${passedDelta > 0 ? '+' : ''}${passedDelta} passed
                                            </span>
                                        </div>
                                    ` : ''}
                                    <div class="flex items-center space-x-2">
                                        <a href="reports/${report.txt}" download class="inline-flex items-center p-1 text-gray-500 hover:text-gray-700" title="Download Raw Report">
                                            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                                            </svg>
                                        </a>
                                        <a href="reports/${report.html}" class="inline-flex items-center p-1 text-indigo-600 hover:text-indigo-800" title="View Report">
                                            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                            </svg>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-1 flex items-center space-x-6">
                                <div class="text-base text-green-600">
                                    ${report.passed} passed
                                </div>
                                <div class="text-base text-red-600">
                                    ${report.failed} failed
                                </div>
                                <div class="text-base text-gray-600">
                                    ${report.compliance}% compliance
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Load and display reports
        async function loadReports() {
            try {
                const response = await fetch('reports/reports_list.json');
                const reports = await response.json();
                
                const reportsListDiv = document.getElementById('reportsList');
                if (reports.length === 0) {
                    reportsListDiv.innerHTML = '<div class="text-center text-gray-500 py-4">No reports available</div>';
                    return;
                }

                reportsListDiv.innerHTML = reports.map((report, index) => 
                    createReportCard(report, index < reports.length - 1 ? reports[index + 1] : null)
                ).join('');
            } catch (error) {
                console.error('Error loading reports:', error);
                document.getElementById('reportsList').innerHTML = 
                    '<div class="text-center text-red-500 py-4">Error loading reports. Please try again later.</div>';
            }
        }

        // Load reports when the page loads
        document.addEventListener('DOMContentLoaded', loadReports);
    </script>
</body>
</html>
