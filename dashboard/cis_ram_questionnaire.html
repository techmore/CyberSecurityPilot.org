<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CIS RAM Assessment Questionnaire</title>
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .toolbar {
            margin: 20px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            display: flex;
            gap: 10px;
        }
        .toolbar button {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #fff;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .toolbar button:hover {
            background: #e9ecef;
        }
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            background: #fff;
        }
        .nav-tab {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid transparent;
            border-radius: 4px 4px 0 0;
            transition: all 0.2s;
        }
        .nav-tab:hover {
            background: #f8f9fa;
        }
        .nav-tab.active {
            background: #fff;
            border-color: #ddd;
            border-bottom-color: #fff;
            margin-bottom: -1px;
            font-weight: bold;
        }
        .tab-container {
            background: #fff;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 4px 4px;
            padding: 20px;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .sub-tabs {
            margin: -20px -20px 20px -20px;
            padding: 10px 20px 0;
            background: #f8f9fa;
        }
        #debug {
            margin-bottom: 20px;
            border-radius: 4px;
        }
        #debugLog {
            font-family: monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        #editHistory {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        .history-entry {
            padding: 8px;
            margin: 5px 0;
            background: #fff;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        #results {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        h1, h2, h3 {
            color: #2c3e50;
            margin-top: 0;
        }
        h1 { font-size: 2em; }
        h2 { font-size: 1.5em; }
        h3 { font-size: 1.2em; }
        .control-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #fff;
        }
        .control-title {
            margin: 0 0 15px 0;
            color: #2c3e50;
            font-size: 1.4em;
        }
        .control-description {
            margin-bottom: 20px;
            color: #666;
            line-height: 1.6;
        }
        .safeguard {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
            border: 1px solid #e9ecef;
        }
        .safeguard h4 {
            color: #2c3e50;
            margin: 0 0 10px 0;
        }
        .implementation-groups {
            margin: 10px 0;
        }
        .ig-tag {
            display: inline-block;
            padding: 3px 8px;
            margin: 0 5px 5px 0;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .ig1 { background: #e8f5e9; color: #2e7d32; }
        .ig2 { background: #fff3e0; color: #f57c00; }
        .ig3 { background: #e3f2fd; color: #1976d2; }
        .requirements {
            margin: 15px 0;
        }
        .requirement-list {
            margin: 10px 0;
        }
        .requirement-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }
        .requirement-item input[type="checkbox"] {
            margin-right: 10px;
        }
        .asset-types {
            margin: 15px 0;
        }
        .asset-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 5px;
        }
        .asset-tag {
            background: #e9ecef;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 0.9em;
            color: #495057;
        }
        .assessment-section {
            margin: 15px 0;
        }
        .maturity-assessment, .evidence-section {
            margin: 10px 0;
        }
        .maturity-assessment select, .evidence-section textarea {
            width: 100%;
            margin-top: 5px;
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
        }
        .evidence-section textarea {
            min-height: 100px;
            resize: vertical;
        }
        .level-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 0.8em;
            margin-left: 5px;
        }
        .level-1 {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        .level-2 {
            background-color: #e3f2fd;
            color: #1565c0;
        }
        .level-3 {
            background-color: #fce4ec;
            color: #c2185b;
        }
        .evidence-field {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        textarea.evidence-field {
            min-height: 60px;
            resize: vertical;
        }
        .maturity-select {
            margin-top: 10px;
            padding: 5px;
            width: 200px;
        }
        .matrix-container {
            margin: 20px 0;
            overflow-x: auto;
        }
        .risk-matrix {
            border-collapse: collapse;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }
        .risk-matrix td, .risk-matrix th {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
        }
        .risk-low { background-color: #c8e6c9; }
        .risk-medium { background-color: #fff9c4; }
        .risk-high { background-color: #ffccbc; }
        .risk-critical { background-color: #ffcdd2; }
        .report-controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
        }
        .sub-tabs {
            margin-bottom: 20px;
        }
        .history-entry {
            font-size: 0.9em;
            color: #666;
            margin: 5px 0;
        }
        .edit-history {
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #e1e1e1;
            border-radius: 5px;
            margin-top: 10px;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        /* Print-specific styles */
        @media print {
            /* Increase content density */
            .container {
                width: 100% !important;
                max-width: none !important;
                padding: 0 !important;
                margin: 0 !important;
            }

            /* Reduce spacing */
            .section {
                padding: 0.25rem !important;
                margin-bottom: 0.25rem !important;
                page-break-inside: avoid;
            }

            /* Compact text */
            p, li {
                margin: 0.1rem 0 !important;
                line-height: 1.2 !important;
            }

            /* Smaller headings */
            h1, h2, h3 {
                margin: 0.25rem 0 !important;
                padding: 0.1rem 0 !important;
            }

            /* Hide non-essential elements */
            .nav-buttons,
            .filter-buttons,
            button:not(.essential),
            .no-print {
                display: none !important;
            }

            /* Compact tables */
            table {
                font-size: 0.9em !important;
            }

            td, th {
                padding: 0.15rem 0.3rem !important;
            }

            /* Reduce margins and padding globally */
            * {
                margin: 0.1rem 0 !important;
                padding: 0.1rem !important;
            }

            /* Force background colors and remove shadows */
            * {
                background: none !important;
                box-shadow: none !important;
                color: black !important;
            }

            /* Ensure all content is visible */
            .collapse {
                display: block !important;
                height: auto !important;
            }

            /* Break pages appropriately */
            .control-section {
                page-break-before: always;
            }

            /* Reduce font sizes */
            body {
                font-size: 9pt !important;
                line-height: 1.2 !important;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
</nav>
<div class="container">
    <nav class="mt-8 bg-white shadow rounded-lg">
        <div class="px-3 py-2 bg-gray-50">
          <div class="flex justify-between items-center">
            Autopilot Portal
            <nav class="flex" aria-label="Breadcrumb">
              <ol role="list" class="flex space-x-4 rounded-md bg-white px-6 shadow-sm">
                <li class="flex">
                  <div class="flex items-center">
                    <a href="dns_table.html" class="text-gray-400 hover:text-gray-500">
                      <svg class="size-5 shrink-0" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon">
                        <path fill-rule="evenodd" d="M9.293 2.293a1 1 0 0 1 1.414 0l7 7A1 1 0 0 1 17 11h-1v6a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-6H3a1 1 0 0 1-.707-1.707l7-7Z" clip-rule="evenodd" />
                      </svg>
                      <span class="sr-only">DNS Portal</span>
                    </a>
                  </div>
                </li>
                <li class="flex">
                  <div class="flex items-center">
                    <svg class="h-full w-6 shrink-0 text-gray-200" viewBox="0 0 24 44" preserveAspectRatio="none" fill="currentColor" aria-hidden="true">
                      <path d="M.293 0l22 22-22 22h1.414l22-22-22-22H.293z" />
                    </svg>
                    <a href="dns_table.html" class="ml-4 text-sm font-medium text-grey-500 hover:text-gray-700">DNS Portal</a>
                  </div>
                </li>
                <li class="flex">
                  <div class="flex items-center">
                    <svg class="h-full w-6 shrink-0 text-gray-200" viewBox="0 0 24 44" preserveAspectRatio="none" fill="currentColor" aria-hidden="true">
                      <path d="M.293 0l22 22-22 22h1.414l22-22-22-22H.293z" />
                    </svg>
                    <a href="website-nmap-nikto.html" class="ml-4 text-sm font-medium text-gray-500 hover:text-gray-700" aria-current="page">Website Monitoring</a>
                  </div>
                </li>
                <li class="flex">
                  <div class="flex items-center">
                    <svg class="h-full w-6 shrink-0 text-gray-200" viewBox="0 0 24 44" preserveAspectRatio="none" fill="currentColor" aria-hidden="true">
                      <path d="M.293 0l22 22-22 22h1.414l22-22-22-22H.293z" />
                    </svg>
                    <a href="cis_ram_questionnaire.html" class="ml-4 text-sm font-medium text-gray-500 hover:text-gray-700">CIS Baselines</a>
                  </div>
                </li>
                <li class="flex">
                  <div class="flex items-center">
                    <svg class="h-full w-6 shrink-0 text-gray-200" viewBox="0 0 24 44" preserveAspectRatio="none" fill="currentColor" aria-hidden="true">
                      <path d="M.293 0l22 22-22 22h1.414l22-22-22-22H.293z" />
                    </svg>
                    <a href="policy_sources.html" class="ml-4 text-sm font-medium text-blue-500 hover:text-gray-700">Policy Templates</a>
                  </div>
                </li>
                <li class="flex">
                  <div class="flex items-center">
                    <svg class="h-full w-6 shrink-0 text-gray-200" viewBox="0 0 24 44" preserveAspectRatio="none" fill="currentColor" aria-hidden="true">
                      <path d="M.293 0l22 22-22 22h1.414l22-22-22-22H.293z" />
                    </svg>
                    <a href="#" class="ml-4 text-sm font-medium text-gray-500 hover:text-gray-700">Projects</a>
                  </div>
                </li>
              </ol>
            </nav>
          </div>
        </div>
      </nav>
<body>
    <div class="container">
        <div id="debug" style="background: #f8f9fa; padding: 10px; margin: 10px 0; display: block;">
            <h3>Debug Information</h3>
            <pre id="debugLog" style="max-height: 200px; overflow-y: auto; background: #fff; padding: 10px;"></pre>
        </div>

        <h1>CIS RAM Assessment Questionnaire</h1>
        <p>Complete this questionnaire to assess your organization's compliance with CIS RAM controls.</p>

        <!-- Action Buttons -->
        <div class="toolbar">
            <button onclick="saveDraft()">Save Draft</button>
            <button onclick="exportPDF()">Export PDF</button>
            <button onclick="toggleHistory()">Show Edit History</button>
        </div>

        <!-- Edit History -->
        <div id="editHistory" style="display: none;">
            <h3>Edit History</h3>
            <div id="historyEntries"></div>
        </div>

        <!-- Main Navigation -->
        <div class="nav-tabs">
            <div class="nav-tab active" data-tab="assessment">Assessment</div>
            <div class="nav-tab" data-tab="risk-matrix">Risk Matrix</div>
            <div class="nav-tab" data-tab="reports">Reports</div>
        </div>

        <!-- Tab Content -->
        <div class="tab-container">
            <!-- Assessment Tab -->
            <div id="assessment" class="tab-content active">
                <!-- Implementation Group Sub-tabs -->
                <div class="sub-tabs nav-tabs">
                    <div class="nav-tab active" data-tab="ig1">IG1 (Basic)</div>
                    <div class="nav-tab" data-tab="ig2">IG2 (Foundational)</div>
                    <div class="nav-tab" data-tab="ig3">IG3 (Organizational)</div>
                </div>

                <!-- Implementation Group Content -->
                <div id="ig1" class="tab-content active"></div>
                <div id="ig2" class="tab-content"></div>
                <div id="ig3" class="tab-content"></div>
            </div>

            <!-- Risk Matrix Tab -->
            <div id="risk-matrix" class="tab-content">
                <h2>Risk Assessment Matrix</h2>
                <div id="risk-analysis"></div>
            </div>

            <!-- Reports Tab -->
            <div id="reports" class="tab-content">
                <h2>Assessment Reports</h2>
                <div id="report-content"></div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="results" style="display: none;">
            <h2>Assessment Results</h2>
            <div id="resultsContent"></div>
        </div>
    </div>

    <script>
        // Initialize global variables
        let cisControls = null;
        let currentTab = 'assessment';
        let currentIG = 'ig1';
        let lastSaved = null;
        let editHistory = [];

        // Debug logging function
        function debugLog(message) {
            console.log(message);
            const debugElement = document.getElementById('debugLog');
            if (debugElement) {
                debugElement.textContent += message + '\n';
            }
        }

        // Load CIS Controls from JSON
        async function loadCISControls() {
            debugLog('Starting to load CIS Controls...');
            try {
                debugLog('Fetching cis_controls.json...');
                const response = await fetch('cis_controls.json');
                debugLog(`Fetch response status: ${response.status}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                debugLog('JSON parsed successfully');
                debugLog(`Found ${Object.keys(data.controls || {}).length} controls`);
                
                cisControls = data;
                
                if (!cisControls || !cisControls.controls) {
                    throw new Error('Invalid CIS Controls data structure');
                }
                
                debugLog('Starting questionnaire initialization...');
                initQuestionnaire();
                debugLog('Questionnaire initialization completed');
            } catch (error) {
                debugLog('ERROR loading CIS Controls: ' + error.message);
                document.querySelector('.container').innerHTML = `
                    <div class="error-message" style="color: red; padding: 20px;">
                        ${error.message}<br>
                        Please ensure cis_controls.json is in the same directory and the server is running.
                    </div>
                `;
                throw error;
            }
        }

        // Initialize questionnaire with controls
        function initQuestionnaire() {
            try {
                debugLog('Initializing questionnaire...');
                if (!cisControls || !cisControls.controls) {
                    throw new Error('No CIS Controls data available');
                }

                // Sort controls by ID
                const sortedControls = Object.entries(cisControls.controls)
                    .sort(([a], [b]) => parseInt(a) - parseInt(b));
                debugLog(`Sorted ${sortedControls.length} controls`);

                // Get IG containers
                const igContainers = {
                    ig1: document.getElementById('ig1'),
                    ig2: document.getElementById('ig2'),
                    ig3: document.getElementById('ig3')
                };
                
                debugLog(`Found containers: ${Object.keys(igContainers).filter(k => igContainers[k]).join(', ')}`);
                
                if (!igContainers.ig1 || !igContainers.ig2 || !igContainers.ig3) {
                    throw new Error('Missing IG containers');
                }

                // Clear existing content
                igContainers.ig1.innerHTML = '';
                igContainers.ig2.innerHTML = '';
                igContainers.ig3.innerHTML = '';
                debugLog('Cleared existing content');

                // Process each control
                sortedControls.forEach(([controlId, control]) => {
                    debugLog(`Processing control ${controlId}: ${control.title}`);
                    const html = generateControlHTML(control, controlId);
                    
                    // Add to appropriate IG tabs based on safeguards
                    const igs = new Set();
                    if (control.safeguards) {
                        Object.values(control.safeguards).forEach(safeguard => {
                            if (safeguard.implementation_groups) {
                                safeguard.implementation_groups.forEach(ig => igs.add(ig));
                            }
                        });
                    }
                    
                    debugLog(`Control ${controlId} belongs to IGs: ${[...igs].join(', ')}`);
                    
                    igs.forEach(ig => {
                        if (igContainers[`ig${ig}`]) {
                            igContainers[`ig${ig}`].innerHTML += html;
                        }
                    });
                });

                debugLog('Setting up tab switching...');
                setupTabSwitching();
                debugLog('Loading saved draft...');
                loadDraft();
                debugLog('Questionnaire fully initialized');
            } catch (error) {
                debugLog('ERROR during initialization: ' + error.message);
                document.querySelector('.container').innerHTML = `
                    <div class="error-message" style="color: red; padding: 20px;">
                        Error initializing questionnaire: ${error.message}<br>
                        Please refresh the page to try again.
                    </div>
                `;
                throw error;
            }
        }

        // Initialize the questionnaire when the DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            debugLog('DOM Content Loaded, starting initialization...');
            
            // Check if debug panel exists
            const debugPanel = document.getElementById('debugLog');
            if (!debugPanel) {
                console.error('Debug panel not found');
            } else {
                debugLog('Debug panel initialized');
            }
            
            // Check if tab containers exist
            const ig1 = document.getElementById('ig1');
            const ig2 = document.getElementById('ig2');
            const ig3 = document.getElementById('ig3');
            
            debugLog(`Tab containers found: IG1=${!!ig1}, IG2=${!!ig2}, IG3=${!!ig3}`);
            
            // Start loading CIS Controls
            debugLog('Starting to load CIS Controls...');
            loadCISControls().catch(error => {
                debugLog('ERROR during initialization: ' + error.message);
                console.error('Initialization error:', error);
            });
        });

        // Generate HTML for a control
        function generateControlHTML(control, controlId) {
            debugLog(`Generating HTML for control ${controlId}`);
            let html = `
                <div class="control-section" data-control-id="${controlId}">
                    <h3 class="control-title">Control ${controlId}: ${control.title}</h3>
                    <div class="control-description">${control.description || ''}</div>
                    <div class="safeguards">`;

            if (control.safeguards) {
                Object.entries(control.safeguards).forEach(([safeguardId, safeguard]) => {
                    html += `
                        <div class="safeguard" id="safeguard-${safeguardId}">
                            <h4>Safeguard ${safeguardId}: ${safeguard.title}</h4>
                            <p>${safeguard.description || ''}</p>
                            
                            <div class="implementation-groups">
                                ${(safeguard.implementation_groups || []).map(ig => 
                                    `<span class="ig-tag ig${ig}">IG${ig}</span>`
                                ).join('')}
                            </div>

                            <div class="requirements">
                                <strong>Requirements:</strong>
                                <div class="requirement-list">
                                    ${(safeguard.requirements || []).map((req, idx) => `
                                        <div class="requirement-item">
                                            <input type="checkbox" id="${safeguardId}-req-${idx}" 
                                                name="${safeguardId}-requirements" />
                                            <label for="${safeguardId}-req-${idx}">${req}</label>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>

                            ${safeguard.asset_types ? `
                                <div class="asset-types">
                                    <strong>Asset Types:</strong>
                                    <div class="asset-tags">
                                        ${safeguard.asset_types.map(type => 
                                            `<span class="asset-tag">${type}</span>`
                                        ).join('')}
                                    </div>
                                </div>
                            ` : ''}

                            <div class="assessment-section">
                                <div class="maturity-assessment">
                                    <strong>Implementation Status:</strong>
                                    <select name="maturity-${safeguardId}" class="maturity-select">
                                        <option value="">Select Status</option>
                                        <option value="yes">Fully Implemented</option>
                                        <option value="partial">Partially Implemented</option>
                                        <option value="no">Not Implemented</option>
                                        <option value="na">Not Applicable</option>
                                    </select>
                                </div>

                                <div class="evidence-section">
                                    <strong>Implementation Evidence:</strong>
                                    <textarea name="evidence-${safeguardId}" class="evidence-field"
                                        placeholder="Describe how this safeguard is implemented, including specific tools, configurations, and processes..."></textarea>
                                </div>
                            </div>
                        </div>`;
                });
            }

            html += `
                    </div>
                </div>`;
            
            return html;
        }

        // Setup tab switching
        function setupTabSwitching() {
            debugLog('Setting up tab switching...');

            // Main tabs (Assessment, Risk Matrix, Reports)
            document.querySelectorAll('.nav-tabs:not(.sub-tabs) .nav-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    debugLog(`Switching main tab to: ${tabId}`);
                    
                    // Update active tab
                    document.querySelectorAll('.nav-tabs:not(.sub-tabs) .nav-tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    tab.classList.add('active');
                    
                    // Update visible content
                    document.querySelectorAll('.tab-container > .tab-content').forEach(content => {
                        content.classList.remove('active');
                        content.style.display = 'none';
                    });
                    const selectedTab = document.getElementById(tabId);
                    if (selectedTab) {
                        selectedTab.classList.add('active');
                        selectedTab.style.display = 'block';
                    }
                    
                    // Update current tab
                    currentTab = tabId;
                    debugLog(`Main tab switched to: ${tabId}`);
                });
            });

            // Implementation Group tabs (IG1, IG2, IG3)
            document.querySelectorAll('.sub-tabs .nav-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const igId = tab.getAttribute('data-tab');
                    debugLog(`Switching IG tab to: ${igId}`);
                    
                    // Update active tab
                    document.querySelectorAll('.sub-tabs .nav-tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    tab.classList.add('active');
                    
                    // Update visible content
                    document.querySelectorAll('#assessment > .tab-content').forEach(content => {
                        content.classList.remove('active');
                        content.style.display = 'none';
                    });
                    const selectedIG = document.getElementById(igId);
                    if (selectedIG) {
                        selectedIG.classList.add('active');
                        selectedIG.style.display = 'block';
                    }
                    
                    // Update current IG
                    currentIG = igId;
                    debugLog(`IG tab switched to: ${igId}`);
                });
            });

            debugLog('Tab switching setup complete');
        }

        // Add styles for active/inactive tabs
        const tabStyles = document.createElement('style');
        tabStyles.textContent = `
            .tab-content {
                display: none;
            }
            .tab-content.active {
                display: block !important;
            }
            .nav-tab {
                cursor: pointer;
                padding: 10px 20px;
                border: 1px solid #ddd;
                border-bottom: none;
                background: #f8f9fa;
                border-radius: 4px 4px 0 0;
                margin-bottom: -1px;
                transition: all 0.2s ease;
            }
            .nav-tab:hover {
                background: #e9ecef;
            }
            .nav-tab.active {
                background: #fff;
                border-bottom: 1px solid #fff;
                font-weight: bold;
                color: #2c3e50;
            }
            .tab-container {
                border: 1px solid #ddd;
                border-radius: 0 0 4px 4px;
                padding: 20px;
                background: #fff;
                min-height: 400px;
            }
            #assessment .tab-content {
                margin-top: 20px;
            }
        `;
        document.head.appendChild(tabStyles);

        // Load draft functionality
        function loadDraft() {
            debugLog('Loading saved draft...');
            const saved = localStorage.getItem('cisRamDraft');
            if (saved) {
                try {
                    const { data, timestamp } = JSON.parse(saved);
                    Object.entries(data).forEach(([controlId, values]) => {
                        const section = document.querySelector(`[data-control-id="${controlId}"]`);
                        if (section) {
                            const maturitySelect = section.querySelector('.maturity-select');
                            const evidenceField = section.querySelector('.evidence-field');
                            
                            if (maturitySelect) maturitySelect.value = values.maturity;
                            if (evidenceField) evidenceField.value = values.evidence;
                        }
                    });
                    debugLog('Draft loaded successfully');
                } catch (error) {
                    debugLog('Error loading draft: ' + error.message);
                }
            } else {
                debugLog('No saved draft found');
            }
        }
    </script>
</body>
</html>
